---
title: "Exploration of Euroleague basketball 2007-2020"
author: "Deli Alan, Rashiti Lirim and Reis Matos Dylan"
date: "`r format(Sys.time(), '%d %B, %Y')`"
format: pdf
editor: visual
output: html_document
---

# Introduction
Overview and Motivation
Related Work
Research questions


We live in a world where the use of statistics and data analysis is of paramount importance to gain a comprehensive understanding of various subjects, allowing individuals to grasp the broader picture of what is happening around them. In the realm of sports, this emphasis on statistics is no exception. In contemporary sports, statistics play a pivotal role in ranking players and determining their relative skills and performance. Furthermore, teams increasingly rely on statistics to gain insights into the strategies employed by opposing teams, enabling them to develop effective counterstrategies for a higher chance of victory.

Beyond the competitive aspect, statistics and data analysis are crucial in sports to track how the game evolves over time. This data-driven approach aids in adapting to changing trends and styles in the sport, as well as in refining player training and development to align with the modern game.

Given our collective passion for sports, our group sought to identify a subject that would resonate with each member. We stumbled upon a remarkable database containing detailed information about basketball games in the EuroLeague, which piqued our interest (further details provided in the Data section of the report).

Recognizing the global significance of the NBA (National Basketball Association) in the world of basketball, as well as its substantial influence on other basketball organizations, we decided to focus our project on analyzing how the playing style has evolved over the years, with a particular emphasis on three-point shooting. We aimed to explore how changes in playing style impact game outcomes and sought to investigate various other statistical trends. Moreover, we intended to shed light on how the game's dynamics shift as it progresses, with strategies adapting based on the game's context---whether it's a closely contested match or not. This analysis also delves into foul statistics in different game scenarios. Lastly, we aimed to provide a comprehensive overview of individual player statistics and their impact on their respective teams.

```{r}
#| echo: false
#| include: false 
source("Main_Wrangle.R")
source("first_graphs.R")
```

# Data
Sources
Description
Wrangling/cleaning
Spotting mistakes and missing data (could be part of EDA too)
Listing anomalies and outliers (could be part of EDA too)


We selected our dataset from Kaggle, a prominent data science competition platform renowned for hosting a wide array of datasets.

The dataset in question provides comprehensive play-by-play information for Euroleague basketball games, spanning from 2007 through 2020. Each entry within this dataset encapsulates a specific game event, encompassing details such as the game minute, involved player and his respective team, action type, and whether it entails a two or three-point shot attempt, along with its successful outcome or miss. This invaluable dataset serves as a foundational resource for analyzing and understanding the intricacies of Euroleague basketball across the specified time period. This extensive dataset, containing over 1.6 million entries, required thorough wrangling to extract and uncover interesting stories.

As an example, here is the first entry of this dataset.

```{r}
#| echo: false 
head(euroleague, 1)
```

Given the wealth of data at our disposal, the process of discerning relevance and assembling pertinent information was essential. We meticulously organized the voluminous play-by-play entries, systematically aggregating them into coherent units of games. Subsequently, these games were further categorized into distinct years or seasons, thereby facilitating the extraction of comprehensive statistical insights related to teams and players. This strategic approach not only streamlines the analytical process but also enables a more granular exploration of performance metrics across the evolving landscape of Euroleague basketball.Many variables were created for our use, we for example wanted to know the winner of the games, know what happens in the first 36 minutes compared to the last four minutes, and we wanted to use the accuracy percentage for some of our data analysis.

After transforming the dataset into stat_per_games, we stumbled upon an outlier.
```{r}
#| echo: false
tail(stat_per_games, 1)
```
In 2018, There was one game between Media Black Team and Media White Team, which ended with a score of 41-49. Those two teams never  appear in any other games and the score was sufficiently low to have a huge impact on our analysis. We decided to erase this game out of stat_per_games and to consider it as an outlier. 
Many teams had to be renamed. We can take the example of Milan, which had for instance the name of EA7 EMPORIO ARMANI MILAN and the name of EA7 EMPORIO ARMANI MILANO in the same year.
Sometimes, the lay-ups and the dunks were not counted as two points, but were counted separately as lay-ups or dunks. Sometimes, the data did not make any difference between two points, a dunk or a lay-up, which makes more sense, as a lay-up or a dunk counts as two-points. We decided to merge the three variables into another variable counting the number of two-points made in total.
Some variables were created only with the goal of verifying that our code was correct. We decided to let those variables in our dataframes, because they might be useful to someone in the future.
# Exploratory data analysis
Spotting mistakes and missing data (could be part of EDA too)
Listing anomalies and outliers (could be part of EDA too)
Mapping out the underlying structure
Identifying the most important variables
Univariate visualizations
Multivariate visualizations
Summary tables


After creating various data frames for different types of analysis we wanted to conduct we plotted various graphs to observe if there was a trend over the years for different statistical measures. Prior to commencing the project, we were aware that the players in the NBA started to attempt more and more three-point shots each year, so we initially examined how did the three-point statistics evolve over the years in the euroleague.

1er GRAPH EVOLUTION DES 3 POINTS A TRAVERS LES ANNEES (three pointer MADE)
```{r}
#| echo: false
print(plot_threeS_over_years)
```
Indeed, as anticipated, we observed a consistent upward trend in the average number of three-pointers made per season over the years. However, the players did not start to get that much more accurate behind the three-point line. The player make more three-pointers, mainly because they just shoot more three-pointers, which came as a shocking surprise. 
With this in mind, we aimed to gain an initial visual insight into whether the trend of teams making more three-pointers over the years has any influence on their win percentage. To do this, we created graphs showcasing the top three teams with the highest win percentages each season, in order to determine if these teams also happen to be the ones making the most three-pointers. 2eme graph les 3 EQUIPE AVEC LE MEILLEURE WIN PERCENTAGE.

And we can see specially in the recent years that the teams that have the best win percentage if we compare with the plot above they often happen to be the ones with the highest three pointer made. prompting us to delve further into its analysis in the subsequent section.

We employed a similar methodology to analyze various statistical aspects. However, for some statistics, we didn't observe any significant trends or peculiar patterns, and if there were, those were relatively small. After we tried to plot the evolution of defensive rebounds over the years, we stumbled upon a weird trend:
```{r}
#| echo: false
print(plot_defreb_over_years)
```

Because of all these factors, we made a deliberate decision to place our primary focus on the  statistics about the three-pointers and the two-pointers. 

Having played a lot of basketball, we also chose to place a special focus on the fouls statistic. Indeed, If a team does enough fouls during a time-period, all the future fouls will lead to two free-throws for the opponent. This rule gives plenty of space for intriguing strategies, such as fouling the opponent at the end of the game to force them to shoot two free-throws, and then try to shoot a three-pointer in order to gain an advantage of one point. We had to create two different dataframes ressembling team_stats_df with a slight nuance: One would focus on the initial 37 minutes of the game and the other one on the final 4 minutes. This division is based on the likelihood of teams committing more fouls in the closing minutes of the game.

Remarkably, our analysis also unveiled a striking pattern during the last 4 minutes of the game, wherein the greater the point difference (indicating a less closely contested game), the fewer fouls teams tended to commit.

GRAPH DES FAUTES DANS LES 4 DERNIERE MINUTES PAR DIFF DE POINTS AVEC SEULEMENT LES POINTS NOIR PAS CELUI AVEC LES POINTS ROUGE AUSSI.

Having made this observation, we were keen to investigate the disparity in fouls between the initial 37 minutes and the last 4 minutes of gameplay, particularly when considering whether a game is closely contested or not. To define a closely contested game, we arbitrarily set a threshold: a game is considered tight if, when entering the last 4 minutes, there is an absolute point difference of fewer than 15 points.

GRAPH AVEC LES 3 BARRES QUI MONTRE LE NOMBRE DE FAUTES DANS 3 CAS DIFFERENT

Our analysis revealed a compelling trend: in tightly contested games, there is a relatively higher frequency of fouls, and on average, these fouls are more often committed by the losing team rather than the winning team. GRAPH QUI MONTRE LES FAUTES COMISE DANS LES 4 DERNIERE MINUTE PAR GAGNANT ET PERDANT. In the upcoming Analysis section, we will delve deeper into the strategy employed by losing teams, involving an increased frequency of fouls during the last 4 minutes, and its impact on the game's outcome.

Furthermore, in light of our observation of varying behavior in the last 4 minutes, we decided to explore whether this pattern extends to other statistics, which we will thoroughly analyze in the following section.


# Analysis
Answers to the research questions
Different methods considered (by players/by team)
Competing approaches
Justifications

It is a common belief that having one of the best scorers in a sports league can significantly improve a team's chances of winning games throughout the season. To investigate the statistical validity of this belief, we conducted an analysis where we aggregated data for each player, calculating the total number of points they scored over the course of a season and then dividing it by the number of games they played. This allowed us to obtain the average number of points a player scored per game.

To further explore the relationship between a player's performance and their team's success, we employed the ***left_join*** function to merge the player's dataset with the team's dataset. This merging process enabled us to determine the win percentage of the top scorer for a given season and examine whether there is a correlation between a player's individual performance and their team's overall success.

By conducting this analysis, we aim to gain insights into the impact of top scorers on team performance and potentially uncover statistical evidence to support or refute the commonly held notion that a top scorer can significantly contribute to a team's success in a sports league.

```{r}
#| echo: false
#| message: false
#| hide: true

best_in_class_player <- stat_per_game_player |>
  group_by(year)|>
  filter(avg_points == max(avg_points, na.rm = TRUE))|>
  ungroup()

ggplot(stat_per_game_player) +
  geom_point(mapping = aes(x = year, y = avg_points, color = PLAYER)) +
  geom_smooth(mapping = aes(x = year, y = avg_points)) +
  labs(title = "Average number of points scored per game",
        subtitle = str_wrap("The points represent different players"),
        x = "Season year",
        y = "Number of points scored") +
  theme_minimal() +
  theme(legend.position = "none")

ggplot(best_in_class_player, aes(x = year, y = win_percentage)) +
  geom_line() +
  geom_point(mapping = aes(x= year, y = win_percentage)) +
  labs(title = "Win percentage of the best statistic player's team",
        x = "Season year",
        y = "Win percentage") +
  ggrepel::geom_label_repel(aes(x = year, y = win_percentage, label = Team),
                            data = best_in_class_player,
                            box.padding = 0.4,
                            size = 1.5) +
  theme_minimal() +
  theme(legend.position = "none")
```

These figures provide insights into the distribution of the average number of points scored by players across different seasons. A notable observation is the consistent trend, which is suspended around an average of approximately five points per game over the years. Despite the presence of players who excel with significantly higher points per game, the density of players clustered around the five-point mark seems to prevent a substantial overall improvement in the average points scored by individual players.

In the second graph, we examine the winning percentage of the team with the top scorer (the highest points in the first plot). Surprisingly, the data reveals that having the top scorer on one's team during a particular year does not emerge as a significant variable for predicting victories. This suggests that the presence of a top scorer alone may not be a strong determinant of a team's success, and other factors likely play a more substantial role in achieving wins.

We also examined the data regarding the number of defensive and offensive rebounds made by players in each season. Our interpretation of this data aligns with our earlier observations regarding the average number of points scored by players. It is evident that achieving success in basketball encompasses a multitude of factors, including tactics, psychology, and physical fitness. However, our analysis underscores that individual player performance, in terms of rebounds or points scored, may not, on its own, carry enough statistical significance to reliably predict a team's chances of winning. The path to victory in basketball appears to be more complex and multifaceted, involving a combination of various factors beyond individual player statistics.

# Conclusion
Take home message
Limitations
Future work?
